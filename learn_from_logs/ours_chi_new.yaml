logCHI kind: ClickHouseInstallation
apiversion: clickhouse.altinity.com/v1
metadata:
    name: clickhouse
    generatename: ""
    namespace: perftesta2
    selflink: ""
    uid: f70f09be-85c3-4bdc-a625-977df3b56c11
    resourceversion: "97413241"
    generation: 1
    creationtimestamp: "2024-06-12T05:14:27Z"
    deletiontimestamp: null
    deletiongraceperiodseconds: null
    labels:
        cluster: perftesta2
        env: testing
        freshworkscorp.com/app: clickhouse-server
        tenant: perftesta2
    annotations: {}
    ownerreferences: []
    finalizers:
        - finalizer.clickhouseinstallation.altinity.com
    managedfields: []
spec:
    defaults:
        templates:
            podTemplate: clickhouse-pod
            dataVolumeClaimTemplate: clickhouse-data
            serviceTemplate: clickhouse-svc
    configuration:
        zookeeper:
            nodes:
                - host: zookeeper-0.zookeepers.perftesta2.svc.cluster.local
                  port: 2181
                - host: zookeeper-1.zookeepers.perftesta2.svc.cluster.local
                  port: 2181
                - host: zookeeper-2.zookeepers.perftesta2.svc.cluster.local
                  port: 2181
        users: {}
        profiles: {}
        settings: {}
        clusters:
            - name: perftesta2
              secret:
                auto: "true"
              layout:
                shardsCount: 1
                replicasCount: 2
    templates:
        podTemplates:
            - name: clickhouse-pod
              metadata:
                name: ""
                generatename: ""
                namespace: ""
                selflink: ""
                uid: ""
                resourceversion: ""
                generation: 0
                creationtimestamp: "0001-01-01T00:00:00Z"
                deletiontimestamp: null
                deletiongraceperiodseconds: null
                labels:
                    tenant: perftesta2
                annotations:
                    0.prometheus.io/path: /metrics
                    0.prometheus.io/port: "9151"
                    0.prometheus.io/scrape: "true"
                    1.prometheus.io/path: /metrics
                    1.prometheus.io/port: "9171"
                    1.prometheus.io/scrape: "true"
                    clickhouse.backup/path: /metrics
                    clickhouse.backup/port: "9171"
                    clickhouse.backup/scrape: "true"
                    prometheus.io/path: /metrics
                    prometheus.io/port: "9363"
                    prometheus.io/scrape: "true"
                ownerreferences: []
                finalizers: []
                managedfields: []
              spec:
                volumes:
                    - name: clickhouse-scripts
                      volumesource:
                        hostpath: null
                        emptydir: null
                        gcepersistentdisk: null
                        awselasticblockstore: null
                        gitrepo: null
                        secret: null
                        nfs: null
                        iscsi: null
                        glusterfs: null
                        persistentvolumeclaim: null
                        rbd: null
                        flexvolume: null
                        cinder: null
                        cephfs: null
                        flocker: null
                        downwardapi: null
                        fc: null
                        azurefile: null
                        configmap:
                            localobjectreference:
                                name: clickhouse-scripts
                            items: []
                            defaultmode: 493
                            optional: null
                        vspherevolume: null
                        quobyte: null
                        azuredisk: null
                        photonpersistentdisk: null
                        projected: null
                        portworxvolume: null
                        scaleio: null
                        storageos: null
                        csi: null
                        ephemeral: null
                initcontainers: []
                containers:
                    - name: clickhouse
                      image: 582763096612.dkr.ecr.us-east-1.amazonaws.com/clickhouse-server:23.8.12.13
                      command: []
                      args: []
                      workingdir: ""
                      ports:
                        - name: http
                          hostport: 0
                          containerport: 8123
                          protocol: ""
                          hostip: ""
                        - name: tcp
                          hostport: 0
                          containerport: 9000
                          protocol: ""
                          hostip: ""
                        - name: interserver
                          hostport: 0
                          containerport: 9010
                          protocol: ""
                          hostip: ""
                        - name: metrics
                          hostport: 0
                          containerport: 9363
                          protocol: ""
                          hostip: ""
                      envfrom: []
                      env: []
                      resources:
                        limits:
                            cpu:
                                format: DecimalSI
                            memory:
                                format: BinarySI
                        requests:
                            cpu:
                                format: DecimalSI
                            memory:
                                format: BinarySI
                        claims: []
                      resizepolicy: []
                      volumemounts:
                        - name: clickhouse-scripts
                          readonly: false
                          mountpath: /clickhouse/scripts
                          subpath: ""
                          mountpropagation: null
                          subpathexpr: ""
                      volumedevices: []
                      livenessprobe:
                        probehandler:
                            exec: null
                            httpget:
                                path: /ping
                                port:
                                    type: 1
                                    intval: 0
                                    strval: http
                                host: ""
                                scheme: HTTP
                                httpheaders: []
                            tcpsocket: null
                            grpc: null
                        initialdelayseconds: 60
                        timeoutseconds: 1
                        periodseconds: 3
                        successthreshold: 1
                        failurethreshold: 10
                        terminationgraceperiodseconds: null
                      readinessprobe:
                        probehandler:
                            exec: null
                            httpget:
                                path: /replicas_status
                                port:
                                    type: 1
                                    intval: 0
                                    strval: http
                                host: ""
                                scheme: HTTP
                                httpheaders: []
                            tcpsocket: null
                            grpc: null
                        initialdelayseconds: 10
                        timeoutseconds: 1
                        periodseconds: 3
                        successthreshold: 1
                        failurethreshold: 3
                        terminationgraceperiodseconds: null
                      startupprobe:
                        probehandler:
                            exec: null
                            httpget: null
                            tcpsocket:
                                port:
                                    type: 1
                                    intval: 0
                                    strval: http
                                host: ""
                            grpc: null
                        initialdelayseconds: 10
                        timeoutseconds: 1
                        periodseconds: 3
                        successthreshold: 1
                        failurethreshold: 10
                        terminationgraceperiodseconds: null
                      lifecycle:
                        poststart: null
                        prestop:
                            exec:
                                command:
                                    - /clickhouse/scripts/prestop.sh
                            httpget: null
                            tcpsocket: null
                      terminationmessagepath: ""
                      terminationmessagepolicy: ""
                      imagepullpolicy: ""
                      securitycontext: null
                      stdin: false
                      stdinonce: false
                      tty: false
                    - name: node-exporter
                      image: 582763096612.dkr.ecr.us-east-1.amazonaws.com/node-exporter:v0.03-multiarch
                      command:
                        - /usr/bin/node-exporter
                      args:
                        - --web.listen-address=0.0.0.0:9151
                        - --collector.disable-defaults
                        - --web.disable-exporter-metrics
                        - --collector.conntrack
                        - --collector.filefd
                        - --collector.netstat
                        - --collector.sockstat
                        - --collector.filesystem
                        - --collector.filesystem.ignored-mount-points
                        - ^\/rootfs\/(var\/lib|run\/docker)\/.*
                        - --collector.xfs
                      workingdir: ""
                      ports:
                        - name: metrics-0
                          hostport: 0
                          containerport: 9151
                          protocol: ""
                          hostip: ""
                      envfrom: []
                      env: []
                      resources:
                        limits:
                            cpu:
                                format: DecimalSI
                            memory:
                                format: BinarySI
                        requests:
                            cpu:
                                format: DecimalSI
                            memory:
                                format: BinarySI
                        claims: []
                      resizepolicy: []
                      volumemounts:
                        - name: clickhouse-data
                          readonly: true
                          mountpath: /var/lib/clickhouse
                          subpath: ""
                          mountpropagation: null
                          subpathexpr: ""
                      volumedevices: []
                      livenessprobe: null
                      readinessprobe: null
                      startupprobe: null
                      lifecycle: null
                      terminationmessagepath: ""
                      terminationmessagepolicy: ""
                      imagepullpolicy: IfNotPresent
                      securitycontext:
                        capabilities: null
                        privileged: null
                        selinuxoptions: null
                        windowsoptions: null
                        runasuser: 65534
                        runasgroup: 65534
                        runasnonroot: null
                        readonlyrootfilesystem: true
                        allowprivilegeescalation: false
                        procmount: null
                        seccompprofile: null
                      stdin: false
                      stdinonce: false
                      tty: false
                    - name: clickhouse-backup
                      image: 582763096612.dkr.ecr.us-east-1.amazonaws.com/clickhouse-backup:2.4.35
                      command:
                        - bash
                        - -xc
                        - /bin/clickhouse-backup server
                      args: []
                      workingdir: ""
                      ports:
                        - name: metrics-1
                          hostport: 0
                          containerport: 9171
                          protocol: ""
                          hostip: ""
                      envfrom: []
                      env:
                        - name: LOG_LEVEL
                          value: debug
                          valuefrom: null
                        - name: API_LISTEN
                          value: 0.0.0.0:9171
                          valuefrom: null
                        - name: API_CREATE_INTEGRATION_TABLES
                          value: "true"
                          valuefrom: null
                        - name: BACKUPS_TO_KEEP_REMOTE
                          value: "7"
                          valuefrom: null
                        - name: REMOTE_STORAGE
                          value: s3
                          valuefrom: null
                        - name: S3_ACL
                          value: private
                          valuefrom: null
                        - name: S3_BUCKET
                          value: dbaas-clickhouse-staging
                          valuefrom: null
                        - name: S3_PATH
                          value: backups/tenants/testing/perftesta2/shard-{shard}/
                          valuefrom: null
                        - name: S3_FORCE_PATH_STYLE
                          value: "true"
                          valuefrom: null
                        - name: S3_DEBUG
                          value: "true"
                          valuefrom: null
                        - name: CLICKHOUSE_PORT
                          value: "9000"
                          valuefrom: null
                        - name: CLICKHOUSE_USERNAME
                          value: ""
                          valuefrom:
                            fieldref: null
                            resourcefieldref: null
                            configmapkeyref: null
                            secretkeyref:
                                localobjectreference:
                                    name: dbaas-clickhouse--testme-default-user
                                key: BACKUP_USER
                                optional: null
                        - name: CLICKHOUSE_PASSWORD
                          value: ""
                          valuefrom:
                            fieldref: null
                            resourcefieldref: null
                            configmapkeyref: null
                            secretkeyref:
                                localobjectreference:
                                    name: dbaas-clickhouse--testme-default-user
                                key: BACKUP_PASSWORD
                                optional: null
                      resources:
                        limits:
                            cpu:
                                format: DecimalSI
                            memory:
                                format: BinarySI
                        requests:
                            cpu:
                                format: DecimalSI
                            memory:
                                format: BinarySI
                        claims: []
                      resizepolicy: []
                      volumemounts: []
                      volumedevices: []
                      livenessprobe: null
                      readinessprobe: null
                      startupprobe: null
                      lifecycle: null
                      terminationmessagepath: ""
                      terminationmessagepolicy: ""
                      imagepullpolicy: Always
                      securitycontext: null
                      stdin: false
                      stdinonce: false
                      tty: false
                ephemeralcontainers: []
                restartpolicy: ""
                terminationgraceperiodseconds: 300
                activedeadlineseconds: null
                dnspolicy: ""
                nodeselector: {}
                serviceaccountname: clickhouse
                deprecatedserviceaccount: ""
                automountserviceaccounttoken: null
                nodename: ""
                hostnetwork: false
                hostpid: false
                hostipc: false
                shareprocessnamespace: null
                securitycontext:
                    selinuxoptions: null
                    windowsoptions: null
                    runasuser: 25425
                    runasgroup: 25425
                    runasnonroot: null
                    supplementalgroups: []
                    fsgroup: 25425
                    sysctls:
                        - name: net.core.somaxconn
                          value: "200000"
                        - name: net.ipv4.ip_local_port_range
                          value: 1024 65535
                    fsgroupchangepolicy: null
                    seccompprofile: null
                imagepullsecrets: []
                hostname: ""
                subdomain: ""
                affinity:
                    nodeaffinity:
                        requiredduringschedulingignoredduringexecution:
                            nodeselectorterms:
                                - matchexpressions:
                                    - key: node.kubernetes.io/instance-type
                                      operator: In
                                      values:
                                        - c7gn.2xlarge
                                        - c6gn.2xlarge
                                        - c7gn.4xlarge
                                        - c6gn.4xlarge
                                  matchfields: []
                        preferredduringschedulingignoredduringexecution: []
                    podaffinity: null
                    podantiaffinity: null
                schedulername: ""
                tolerations: []
                hostaliases: []
                priorityclassname: ""
                priority: null
                dnsconfig: null
                readinessgates: []
                runtimeclassname: null
                enableservicelinks: null
                preemptionpolicy: null
                overhead: {}
                topologyspreadconstraints: []
                sethostnameasfqdn: null
                os: null
                hostusers: null
                schedulinggates: []
                resourceclaims: []
        volumeClaimTemplates:
            - name: clickhouse-data
              storagemanagement: {}
              spec:
                accessmodes:
                    - ReadWriteOnce
                selector: null
                resources:
                    limits: {}
                    requests:
                        storage:
                            format: BinarySI
                    claims: []
                volumename: ""
                storageclassname: clickhouse-server-storage-ext4
                volumemode: null
                datasource: null
                datasourceref: null
        serviceTemplates:
            - name: clickhouse-svc
              generateName: r53-headless-chendpoint-{chi}
              metadata:
                name: ""
                generatename: ""
                namespace: ""
                selflink: ""
                uid: ""
                resourceversion: ""
                generation: 0
                creationtimestamp: "0001-01-01T00:00:00Z"
                deletiontimestamp: null
                deletiongraceperiodseconds: null
                labels: {}
                annotations:
                    external-dns.alpha.kubernetes.io/hostname: perftesta2.clickhouse.internal-us-east-1
                    external-dns.alpha.kubernetes.io/ttl: "10"
                ownerreferences: []
                finalizers: []
                managedfields: []
              spec:
                ports:
                    - name: http
                      protocol: ""
                      appprotocol: null
                      port: 8123
                      targetport:
                        type: 0
                        intval: 0
                        strval: ""
                      nodeport: 0
                    - name: tcp
                      protocol: ""
                      appprotocol: null
                      port: 9000
                      targetport:
                        type: 0
                        intval: 0
                        strval: ""
                      nodeport: 0
                    - name: interserver
                      protocol: ""
                      appprotocol: null
                      port: 9010
                      targetport:
                        type: 0
                        intval: 0
                        strval: ""
                      nodeport: 0
                selector: {}
                clusterip: None
                clusterips: []
                type: ""
                externalips: []
                sessionaffinity: ""
                loadbalancerip: ""
                loadbalancersourceranges: []
                externalname: ""
                externaltrafficpolicy: ""
                healthchecknodeport: 0
                publishnotreadyaddresses: false
                sessionaffinityconfig: null
                ipfamilies: []
                ipfamilypolicy: null
                allocateloadbalancernodeports: null
                loadbalancerclass: null
                internaltrafficpolicy: null